#!/bin/bash

echo "üß™ –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∏—Å—å–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Å—Ç–∏–ª–µ–π"
echo "=============================================="
echo ""

URL="https://functions.poehali.dev/90b50454-3ef3-4d5f-add1-e22941c980f4"

echo "üìù –ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–∏—Å—å–º–æ —Ç–∏–ø–∞ '–ü—Ä–æ–¥–∞–∂–∞ —á–µ—Ä–µ–∑ –±–æ–ª—å' (content_type_id=1)"
echo "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ù–∞–ø–∏—à–∏ –ø—Ä–æ –±–æ–ª—å HR-–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Ä—è—é—Ç –ª—É—á—à–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤"
echo ""

curl -X POST "$URL" \
  -H "Content-Type: application/json" \
  -d '{
    "event_id": 1,
    "content_type_id": 1,
    "instructions": "–ù–∞–ø–∏—à–∏ –ø–∏—Å—å–º–æ –ø—Ä–æ –±–æ–ª—å HR-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Ä—è—é—Ç –ª—É—á—à–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏–∑-–∑–∞ –¥–æ–ª–≥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞–π–º–∞. –£–ø–æ–º—è–Ω–∏ 3 —Å–ø–∏–∫–µ—Ä–æ–≤ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏."
  }' \
  | jq -r '
    if .success then
      "‚úÖ –ì–ï–ù–ï–†–ê–¶–ò–Ø –£–°–ü–ï–®–ù–ê\n" +
      "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n" +
      "üìß –¢–µ–º–∞: " + .subject + "\n" +
      "üìã –®–∞–±–ª–æ–Ω: " + .template_name + "\n" +
      "üìö –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ RAG: " + (.rag_context_items | tostring) + " —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n\n" +
      
      (if .validation then
        "üé® –í–ê–õ–ò–î–ê–¶–ò–Ø –°–¢–ò–õ–ï–ô:\n" +
        "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n" +
        "–û–±—â–∏–π –±–∞–ª–ª: " + (.validation.overall_score | tostring) + " / 10\n" +
        "–°—Ç–∞—Ç—É—Å: " + (if .validation.passed then "‚úÖ PASSED" else "‚ùå FAILED" end) + "\n\n" +
        
        (if (.validation.issues | length) > 0 then
          "‚ö†Ô∏è  –ü—Ä–æ–±–ª–µ–º—ã:\n" +
          (.validation.issues | map("   ‚Ä¢ " + .) | join("\n")) + "\n\n"
        else "" end) +
        
        (if (.validation.suggestions | length) > 0 then
          "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\n" +
          (.validation.suggestions | map("   ‚Ä¢ " + .) | join("\n")) + "\n"
        else "" end)
      else
        "‚ö†Ô∏è  –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞\n"
      end) +
      
      "\nüìÑ HTML —Ä–∞–∑–º–µ—Ä: " + (.html | length | tostring) + " —Å–∏–º–≤–æ–ª–æ–≤"
    else
      "‚ùå –û–®–ò–ë–ö–ê: " + (.error // "Unknown error")
    end
  '

echo ""
echo "=============================================="
echo "–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω"
