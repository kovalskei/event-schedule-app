{
  "tests": [
    {
      "name": "Adapt template with CTA and preheader",
      "method": "POST",
      "path": "/",
      "body": {
        "action": "adapt",
        "html": "<!DOCTYPE html><html><body><div style=\"display:none;max-height:0;\">Preview text</div><h1>Welcome</h1><p>Check out our offer</p><a href=\"https://example.com\" style=\"background:#007bff;padding:10px 20px;color:white;border-radius:5px;\">Learn More</a></body></html>",
        "options": {
          "cta_strategy": "auto",
          "inject_preheader": false
        }
      },
      "expectedStatus": 200,
      "expectedBody": {
        "stats": {
          "total_placeholders": 4,
          "cta_count": 1
        }
      },
      "bodyMatcher": "partial"
    },
    {
      "name": "Render template with data and UTM",
      "method": "POST",
      "path": "/",
      "body": {
        "action": "render",
        "template": "<h1>{{title}}</h1><a href=\"{{cta_1_url}}\">{{cta_1_text}}</a>",
        "data": {
          "title": "Special Offer",
          "cta_1_url": "https://example.com/promo",
          "cta_1_text": "Get Started"
        },
        "utm_params": {
          "utm_source": "newsletter",
          "utm_medium": "email",
          "utm_campaign": "launch"
        }
      },
      "expectedStatus": 200,
      "expectedBody": {
        "rendered_html": "string",
        "plain_text": "string",
        "utm_applied": true
      },
      "bodyMatcher": "partial"
    },
    {
      "name": "Validate content with spam triggers",
      "method": "POST",
      "path": "/",
      "body": {
        "action": "validate",
        "data": {
          "subject": "100% FREE OFFER!!!",
          "preheader": "This is a test preheader that is definitely way too long for email standards and will be truncated by most email clients"
        }
      },
      "expectedStatus": 200,
      "expectedBody": {
        "valid": false
      },
      "bodyMatcher": "partial"
    },
    {
      "name": "Auto-inject preheader if missing",
      "method": "POST",
      "path": "/",
      "body": {
        "action": "adapt",
        "html": "<html><body><h1>Title</h1><p>Content</p></body></html>",
        "options": {
          "inject_preheader": true
        }
      },
      "expectedStatus": 200,
      "expectedBody": {
        "stats": {
          "total_placeholders": 2
        }
      },
      "bodyMatcher": "partial"
    }
  ]
}