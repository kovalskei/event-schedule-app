# Event Marketing Automation Platform - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

> **–í–ê–ñ–ù–û –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò:** –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É –ø—Ä–æ–µ–∫—Ç–∞.  
> –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞—â–∞–π—Å—è –∫ –Ω–µ–º—É –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∏—Å–µ–º –∏–ª–∏ —Ä–∞–±–æ—Ç–µ —Å AI.

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
- [Backend —Ñ—É–Ω–∫—Ü–∏–∏](#backend-—Ñ—É–Ω–∫—Ü–∏–∏)
- [–ö—Ä–∏—Ç–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞](#–∫—Ä–∏—Ç–∏—á–Ω–∞—è-–ª–æ–≥–∏–∫–∞)
- [Workflow –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∏—Å–µ–º](#workflow-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏-–ø–∏—Å–µ–º)
- [–ß–∞—Å—Ç—ã–µ –∫–µ–π—Å—ã](#—á–∞—Å—Ç—ã–µ-–∫–µ–π—Å—ã)

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### Stack
- **Frontend**: React + TypeScript + Vite + Tailwind CSS + shadcn/ui
- **Backend**: Cloud Functions (Python 3.11)
- **Database**: PostgreSQL (Simple Query Protocol only)
- **AI**: OpenAI GPT-4o-mini / OpenRouter

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
event-schedule-app/
‚îú‚îÄ‚îÄ src/                    # Frontend React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ pages/             # –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EventsManager.tsx      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CampaignManager.tsx    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CampaignHistory.tsx    # –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AISettings.tsx         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ AI
‚îÇ   ‚îî‚îÄ‚îÄ components/        # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ backend/               # Cloud Functions
‚îÇ   ‚îú‚îÄ‚îÄ events-manager/    # API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∏—Å–µ–º
‚îÇ   ‚îú‚îÄ‚îÄ campaign-manager/  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ google-docs-reader/# –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Docs
‚îÇ   ‚îú‚îÄ‚îÄ unisender-manager/ # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UniSender
‚îÇ   ‚îî‚îÄ‚îÄ sync-events-unisender/ # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å UniSender
‚îî‚îÄ‚îÄ db_migrations/         # SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```

---

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

#### `events` - –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
```sql
- id, name, description
- start_date, end_date
- program_doc_id       # URL Google Sheets —Å –ø—Ä–æ–≥—Ä–∞–º–º–æ–π
- pain_doc_id          # URL Google Doc —Å –±–æ–ª—è–º–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏
- default_tone         # –¢–æ–Ω –ø–∏—Å–µ–º (friendly/professional/etc)
- logo_url
- email_template_examples
```

#### `content_types` - –¢–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–∏—Å–µ–º
```sql
- id, event_id, name
- description
–ü—Ä–∏–º–µ—Ä—ã: "–ê–Ω–æ–Ω—Å", "–ü—Ä–æ–¥–∞–∂–∞ —á–µ—Ä–µ–∑ –±–æ–ª—å", "–ü–æ–ª–µ–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç"
```

#### `email_templates` - –®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º
```sql
- id, event_id, content_type_id
- name                 # –ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- html_template        # HTML —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ {pain_points}, {program_topics}
- subject_template     # –®–∞–±–ª–æ–Ω —Ç–µ–º—ã –ø–∏—Å—å–º–∞
- instructions         # ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–º–ø—Ç –¥–ª—è AI (—á—Ç–æ –∏ –∫–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å)
```

**‚ö†Ô∏è –í–ê–ñ–ù–û –ø—Ä–æ `instructions`:**
–≠—Ç–æ –ù–ï –ø—Ä–æ—Å—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ. –≠—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞:
- –ö–∞–∫–æ–π —Ç–æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π/–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π)
- –ö–∞–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∏—Å—å–º–∞ —Å–æ–∑–¥–∞—Ç—å
- –°–∫–æ–ª—å–∫–æ —Å–ø–∏–∫–µ—Ä–æ–≤ –≤—ã–±—Ä–∞—Ç—å (1-3 / 2-4)
- –ö–∞–∫–∏–µ –±–æ–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö/–ø–ª–æ—Ö–∏—Ö —Ç–µ–º –ø–∏—Å—å–º–∞

#### `event_mailing_lists` - –°–ø–∏—Å–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏
```sql
- id, event_id, name
- content_type_ids     # –ú–∞—Å—Å–∏–≤ ID —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- content_plan_doc_id  # URL Google Doc —Å –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–æ–º
- ai_provider, ai_model, ai_assistant_id
- unisender_list_id
```

#### `generated_emails` - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞
```sql
- id, event_list_id, content_type_id
- subject, html_content
- title                # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–∞ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–µ–π)
- status              # draft / approved / sent
- campaign_id         # ID –∫–∞–º–ø–∞–Ω–∏–∏ –≤ UniSender (–ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏)
```

#### `email_campaigns` - –ò—Å—Ç–æ—Ä–∏—è –∫–∞–º–ø–∞–Ω–∏–π
```sql
- id, event_list_id, generated_email_id
- unisender_campaign_id, status
- sent_at, recipients_count
- opens_count, clicks_count
```

---

## ‚öôÔ∏è Backend —Ñ—É–Ω–∫—Ü–∏–∏

### `events-manager` (Python)
**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø–∏—Å–µ–º**

URL: https://functions.poehali.dev/b56e5895-fb22-4d96-b746-b046a9fd2750

#### Endpoints:

**GET ?action=list_events**
- –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π

**GET ?action=get_event&event_id=1**
- –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è

**POST action=generate_drafts**
```json
{
  "list_id": 1
}
```
- ‚ö†Ô∏è –ì–ï–ù–ï–†–ê–¶–ò–Ø –ß–ï–†–ù–û–í–ò–ö–û–í —á–µ—Ä–µ–∑ AI
- **–ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏** (–º–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ)
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ `content_type_ids`:
  1. –ß–∏—Ç–∞–µ—Ç `instructions` –∏–∑ `email_templates`
  2. AI –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–±–æ–ª–∏ + —Å–ø–∏–∫–µ—Ä—ã)
  3. –í—Å—Ç–∞–≤–ª—è–µ—Ç –≤ –≥–æ—Ç–æ–≤—ã–π `html_template`

**POST action=generate_from_content_plan**
```json
{
  "event_list_id": 1
}
```
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏)
- ‚úÖ **–ü–†–û–í–ï–†–Ø–ï–¢ –î–£–ë–õ–ò** –ø–æ –ø–æ–ª—é `title`
- –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–∏—Å—å–º–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{generated_count, skipped_count, message}`

**GET ?action=get_drafts&list_id=1**
- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞

**POST action=create_content_types**
- –°–æ–∑–¥–∞—Ç—å —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

## üö® –ö—Ä–∏—Ç–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –î–≤–µ —Ä–∞–∑–Ω—ã–µ –ª–æ–≥–∏–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

#### 1. **generate_drafts** - AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–µ–π
```python
# ‚ùå –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏!
# ‚úÖ AI —Å–æ–∑–¥–∞—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑
# ‚úÖ –ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ä–∞–∑

for content_type_id in content_type_ids:
    # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–º–ø—Ç –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    instructions = email_templates[content_type_id]['instructions']
    
    # AI –ø–æ–ª—É—á–∞–µ—Ç:
    # - instructions (–ø—Ä–æ–º–ø—Ç –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫: —á—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–æ–π —Ç–æ–Ω)
    # - program_text (Google Sheets —Å –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è)
    # - pain_points_text (Google Doc —Å –±–æ–ª—è–º–∏ –∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏)
    
    # AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
    ai_result = call_openai({
        "subject": "–¶–µ–ø–ª—è—é—â–∞—è —Ç–µ–º–∞ –ø–∏—Å—å–º–∞",
        "pain_points": "1-2 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –±–æ–ª–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ü–∏—Ç–∞—Ç–∞–º–∏",
        "program_topics": "2-4 —Å–ø–∏–∫–µ—Ä–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏—Ö —Ç–µ–º"
    })
    
    # –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º AI-–∫–æ–Ω—Ç–µ–Ω—Ç –≤ –≥–æ—Ç–æ–≤—ã–π HTML-—à–∞–±–ª–æ–Ω
    html = html_template.replace('{pain_points}', ai_result['pain_points'])
    html = html.replace('{program_topics}', ai_result['program_topics'])
    
    INSERT INTO generated_emails (subject, html_content, status='draft')
```

**–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫:** —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–µ –ø–∏—Å—å–º–∞ —Å –¥—Ä—É–≥–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

#### 2. **generate_from_content_plan** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –ø–ª–∞–Ω–∞ –° –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥—É–±–ª–µ–π
```python
# ‚úÖ –ü–†–û–í–ï–†–Ø–ï–¢ –¥—É–±–ª–∏ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É!
# ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–∏—Å—å–º–∞ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
# ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

content_plan = read_google_doc(content_plan_doc_id)
# –§–æ—Ä–º–∞—Ç: "–ó–∞–≥–æ–ª–æ–≤–æ–∫\t–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞"
# –ü—Ä–∏–º–µ—Ä: "1. –û–û–û –ù–ò–¶ –§–ê–†–ú–û–ë–û–†–û–ù–ê, –°–≤–µ—Ç–ª–∞–Ω–∞ –ú: –•–æ—Ç–µ–ª–∞ —É–∑–Ω–∞—Ç—å...\t–ê–Ω–æ–Ω—Å"

generated_count = 0
skipped_count = 0

for row in content_plan:
    title = row['title']  # "1. –û–û–û –ù–ò–¶ –§–ê–†–ú–û–ë–û–†–û–ù–ê, –°–≤–µ—Ç–ª–∞–Ω–∞ –ú: ..."
    content_type = row['content_type']  # "–ê–Ω–æ–Ω—Å"
    
    # ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª—è –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É
    existing = SELECT * FROM generated_emails 
               WHERE event_list_id = ? AND title = ?
    
    if existing:
        skipped_count += 1
        continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º
    
    # AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    ai_result = call_openai(title, content_type, instructions)
    
    INSERT INTO generated_emails (
        title,           # ‚Üê –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–µ–π
        subject, 
        html_content
    )
    generated_count += 1

return {
    'generated_count': generated_count,
    'skipped_count': skipped_count,
    'message': f'–°–æ–∑–¥–∞–Ω–æ {generated_count} –ø–∏—Å–µ–º, –ø—Ä–æ–ø—É—â–µ–Ω–æ –¥—É–±–ª–µ–π: {skipped_count}'
}
```

**–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫:** –ø—Ä–æ–ø—É—Å—Ç–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ, —Å–æ–∑–¥–∞—Å—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ

---

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç AI

**AI –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML —Å –Ω—É–ª—è!**

AI –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–æ–ª—å **–∫–æ–Ω—Ç–µ–Ω—Ç-—Ä–µ–¥–∞–∫—Ç–æ—Ä–∞**:
1. –ß–∏—Ç–∞–µ—Ç `instructions` (—á—Ç–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å)
2. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É (1500+ —Å—Ç—Ä–æ–∫)
3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–æ–ª–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (500+ —Ü–∏—Ç–∞—Ç)
4. **–í—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç**
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–º–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏
6. –§—Ä–∞–≥–º–µ–Ω—Ç—ã –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –≥–æ—Ç–æ–≤—ã–π `html_template`

**–ü—Ä–æ–º–ø—Ç –¥–ª—è AI:**
```python
user_prompt = f"""–¢—ã ‚Äî email-–º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏. 
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–∏—Å—å–º–∞.

–ò–ù–°–¢–†–£–ö–¶–ò–ò:
{instructions}  # –ò–∑ email_templates - –ø–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç!

–ü–†–û–ì–†–ê–ú–ú–ê –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø (—Å–ø–∏–∫–µ—Ä—ã, —Ç–µ–º—ã, –≤—Ä–µ–º—è):
{program_text[:20000]}

–ë–û–õ–ò –ò –ó–ê–ü–†–û–°–´ –ê–£–î–ò–¢–û–†–ò–ò:
{pain_points_text[:20000]}

–ó–ê–î–ê–ß–ê:
1. –ü—Ä–æ—á–∏—Ç–∞–π –ò–ù–°–¢–†–£–ö–¶–ò–ò ‚Äî —Ç–∞–º –æ–ø–∏—Å–∞–Ω–æ, –∫–∞–∫–æ–π —Ç–∏–ø –ø–∏—Å—å–º–∞ –Ω—É–∂–µ–Ω
2. –í—ã–±–µ—Ä–∏ –∏–∑ –ü–†–û–ì–†–ê–ú–ú–´ 2-4 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å–ø–∏–∫–µ—Ä–∞/—Ç–µ–º—ã
3. –í—ã–±–µ—Ä–∏ –∏–∑ –ë–û–õ–ï–ô 1-3 —Ä–µ–∞–ª—å–Ω—ã—Ö —Ü–∏—Ç–∞—Ç—ã (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ—Ä–∞–∑—ã –ª—é–¥–µ–π!)
4. –ü—Ä–∏–¥—É–º–∞–π —Ü–µ–ø–ª—è—é—â—É—é —Ç–µ–º—É –ø–∏—Å—å–º–∞

–í–ï–†–ù–ò –°–¢–†–û–ì–û JSON:
{{
  "subject": "–¢–µ–º–∞ –ø–∏—Å—å–º–∞ (–∂–∏–≤–∞—è, –±–µ–∑ –∫–ª–∏—à–µ)",
  "pain_points": "1-2 –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞ —Å –±–æ–ª—è–º–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏",
  "program_topics": "–°–ø–∏—Å–æ–∫ –∏–∑ 2-4 —Å–ø–∏–∫–µ—Ä–æ–≤ —Å –∫—Ä–∞—Ç–∫–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ–º"
}}

–ù–ï –ø–∏—à–∏ HTML, –ù–ï –¥–æ–±–∞–≤–ª—è–π –ª–∏—à–Ω–µ–≥–æ ‚Äî —Ç–æ–ª—å–∫–æ JSON.
"""
```

**–û—Ç–≤–µ—Ç AI (–ø—Ä–∏–º–µ—Ä):**
```json
{
  "subject": "–ö–∞–∫ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∫–æ–≥–¥–∞ –¥–µ–Ω–µ–≥ –Ω–∞ –ø—Ä–µ–º–∏–∏ –Ω–µ—Ç",
  "pain_points": "–°–≤–µ—Ç–ª–∞–Ω–∞ –∏–∑ –û–û–û –ù–ò–¶ –§–ê–†–ú–û–ë–û–†–û–ù–ê: \"–í–æ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É –≤—ã –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏, –Ω–æ –Ω–∞ —á—Ç–æ –≥–ª–∞–∑ —É–ø–∞–ª? –ö–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ —Ä–µ—à–∞–µ—Ç–µ –ø–æ –æ–±—É—á–µ–Ω–∏—é –≤ –∫–æ–º–ø–∞–Ω–∏–∏?\" –ö–∞—Ä–∏–Ω–∞ –ö—É–∑–∏–Ω–∞, HR BP: \"–í–æ—Ç, —á—Ç–æ –≤–∞–º –∏–∑ —ç—Ç–∏—Ö –≤—Å–µ—Ö —Ç–µ–º–∞—Ç–∏–∫ –Ω–∞–∏–±–æ–ª–µ–µ –±–ª–∏–∑–∫–æ? –í –æ–±—É—á–µ–Ω–∏–∏, –º–æ–∂–µ—Ç –±—ã—Ç—å, —á—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å?\"",
  "program_topics": "üéØ –Æ–ª–∏—è –ë—É–≥–∏–Ω–æ–≤–∞ (Ozon) ‚Äî –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ –∑–∞ 2 —á–∞—Å–∞ —Å –ø–æ–º–æ—â—å—é AI\nüéØ –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞ (–Ø–Ω–¥–µ–∫—Å) ‚Äî –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –Ω–∞–π–º–∞\nüéØ –î–º–∏—Ç—Ä–∏–π –°–∏–¥–æ—Ä–æ–≤ (–°–±–µ—Ä) ‚Äî –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–∫–æ–ª–µ–Ω–∏—è Z –±–µ–∑ –ø—Ä–µ–º–∏–π"
}
```

**–î–∞–ª–µ–µ:**
```python
html = html_template.replace('{pain_points}', ai_result['pain_points'])
html = html.replace('{program_topics}', ai_result['program_topics'])
```

---

### ‚ö†Ô∏è –í–ê–ñ–ù–û: HTML —à–∞–±–ª–æ–Ω—ã

–í `email_templates.html_template` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã:
- `{pain_points}` - AI –≤—ã–±–∏—Ä–∞–µ—Ç 1-3 –±–æ–ª–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `{program_topics}` - AI –≤—ã–±–∏—Ä–∞–µ—Ç 2-4 —Å–ø–∏–∫–µ—Ä–∞ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã

**–ü—Ä–∏–º–µ—Ä —à–∞–±–ª–æ–Ω–∞:**
```html
<table width="600" cellpadding="0" cellspacing="0">
  <tr>
    <td style="padding: 30px 40px; font-size: 16px;">
      –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ,<br><br>
      {pain_points}
    </td>
  </tr>
  
  <tr>
    <td style="padding: 20px 40px; font-weight: bold;">
      –ù–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ Human –≥–æ–≤–æ—Ä–∏–º –æ —Ä–µ—à–µ–Ω–∏—è—Ö —ç—Ç–∏—Ö –∑–∞–¥–∞—á:
    </td>
  </tr>
  
  <tr>
    <td style="padding: 20px 40px;">
      {program_topics}
    </td>
  </tr>
  
  <tr>
    <td align="center" style="padding: 30px 40px;">
      <a href="#" style="background-color: #AE32E3; color: #fff; padding: 12px 28px;">
        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É
      </a>
    </td>
  </tr>
</table>
```

**‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:**
```python
# –í—Å—Ç–∞–≤–∫–∞ –í–°–ï–ì–û —Ç–µ–∫—Å—Ç–∞ –±–æ–ª–µ–π
html = html_template.replace('{pain_points}', pain_points_text)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 50000 —Å–∏–º–≤–æ–ª–æ–≤ –±–æ–ª–µ–π –≤ –æ–¥–Ω–æ–º –ø–∏—Å—å–º–µ!
```

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:**
```python
# AI –≤—ã–±–∏—Ä–∞–µ—Ç 1-3 –±–æ–ª–∏
ai_result = call_openai(instructions, program_text, pain_points_text)
html = html_template.replace('{pain_points}', ai_result['pain_points'])
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 2-3 –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```

---

## üîÑ Workflow –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∏—Å–µ–º

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Å—ã–ª–∫–∏ (ID=3)
2. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–ø–∏—Å–∫–∞ –≤—ã–±—Ä–∞–Ω—ã —Ç–∏–ø—ã: [1:"–ê–Ω–æ–Ω—Å", 3:"–ü—Ä–æ–¥–∞–∂–∞ —á–µ—Ä–µ–∑ –±–æ–ª—å"]
3. –ù–∞–∂–∏–º–∞–µ—Ç "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏"

4. Frontend ‚Üí POST /events-manager
   {
     "action": "generate_drafts",
     "list_id": 3
   }

5. Backend:
   ‚úì –ß–∏—Ç–∞–µ—Ç event_mailing_lists (ID=3)
   ‚úì –ü–æ–ª—É—á–∞–µ—Ç content_type_ids = [1, 3]
   ‚úì –ß–∏—Ç–∞–µ—Ç program_doc_id –∏ pain_doc_id
   ‚úì –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É –∏–∑ Google Sheets
   ‚úì –ó–∞–≥—Ä—É–∂–∞–µ—Ç –±–æ–ª–∏ –∏–∑ Google Doc
   
   –î–ª—è content_type_id = 1:
     ‚úì SELECT instructions FROM email_templates WHERE content_type_id=1
     ‚úì –í—ã–∑–æ–≤ AI —Å –ø—Ä–æ–º–ø—Ç–æ–º (instructions + –ø—Ä–æ–≥—Ä–∞–º–º–∞ + –±–æ–ª–∏)
     ‚úì AI –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {subject, pain_points, program_topics}
     ‚úì –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ html_template
     ‚úì INSERT –≤ generated_emails (status='draft')
   
   –î–ª—è content_type_id = 3:
     ‚úì –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ...

6. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {count: 2, message: "–°–æ–∑–¥–∞–Ω–æ 2 –ø–∏—Å—å–º–∞"}

7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–Ω–æ–≤–∞ –Ω–∞–∂–∞—Ç—å "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"
   ‚Üí –°–æ–∑–¥–∞—Å—Ç—Å—è –µ—â—ë 2 –ø–∏—Å—å–º–∞ —Å –î–†–£–ì–ò–ú –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
```

**–ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ** ‚Üí AI –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–∞–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç.

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–∞ (—Ä–∞–∑–æ–≤–∞—è)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç Google Doc —Å –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–æ–º:
   
   –ó–∞–≥–æ–ª–æ–≤–æ–∫	–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   1. –û–û–û –ù–ò–¶ –§–ê–†–ú–û–ë–û–†–û–ù–ê, –°–≤–µ—Ç–ª–∞–Ω–∞ –ú: –•–æ—Ç–µ–ª–∞ —É–∑–Ω–∞—Ç—å...	–ê–Ω–æ–Ω—Å
   2. –ö–∞—Ä–∏–Ω–∞ –ö—É–∑–∏–Ω–∞, HR BP: –í–æ—Ç, —á—Ç–æ –≤–∞–º –∏–∑ —ç—Ç–∏—Ö —Ç–µ–º–∞—Ç–∏–∫...	–ü—Ä–æ–¥–∞–∂–∞ —á–µ—Ä–µ–∑ –±–æ–ª—å
   3. –ö—Å–µ–Ω–∏—è, PreventAge: –ï—Å–ª–∏ —á–µ—Å—Ç–Ω–æ, –Ω–∞–≤–µ—Ä–Ω–æ–µ...	–ü–æ–ª–µ–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

2. –£–∫–∞–∑—ã–≤–∞–µ—Ç URL –≤ content_plan_doc_id —Å–ø–∏—Å–∫–∞ —Ä–∞—Å—Å—ã–ª–∫–∏

3. –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑ –ø–ª–∞–Ω–∞"

4. Frontend ‚Üí POST /events-manager
   {
     "action": "generate_from_content_plan",
     "event_list_id": 3
   }

5. Backend:
   ‚úì –ß–∏—Ç–∞–µ—Ç content_plan_doc_id
   ‚úì –ü–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫–∏ (–∑–∞–≥–æ–ª–æ–≤–æ–∫\t—Ç–∏–ø)
   
   –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏:
     ‚úì title = "1. –û–û–û –ù–ò–¶ –§–ê–†–ú–û–ë–û–†–û–ù–ê, –°–≤–µ—Ç–ª–∞–Ω–∞ –ú: –•–æ—Ç–µ–ª–∞ —É–∑–Ω–∞—Ç—å..."
     ‚úì content_type = "–ê–Ω–æ–Ω—Å"
     
     ‚úì SELECT * FROM generated_emails 
       WHERE event_list_id=3 AND title='{title}'
     
     –ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω–æ:
       ‚úì AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞
       ‚úì INSERT –≤ generated_emails (title, subject, html_content)
       ‚úì generated_count++
     
     –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ:
       ‚úì skipped_count++
       ‚úì continue

6. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: 
   {
     generated_count: 3, 
     skipped_count: 0,
     message: "–°–æ–∑–¥–∞–Ω–æ 3 –ø–∏—Å–µ–º"
   }

7. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫:
   ‚Üí {generated_count: 0, skipped_count: 3, message: "–°–æ–∑–¥–∞–Ω–æ 0 –ø–∏—Å–µ–º, –ø—Ä–æ–ø—É—â–µ–Ω–æ –¥—É–±–ª–µ–π: 3"}
```

---

## üìù –ß–∞—Å—Ç—ã–µ –∫–µ–π—Å—ã

### ‚ùì –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞?

1. **–î–æ–±–∞–≤–∏—Ç—å –≤ content_types:**
```sql
INSERT INTO content_types (event_id, name, description)
VALUES (1, '–ü—Ä–æ–¥–∞–∂–∞ —á–µ—Ä–µ–∑ –±–æ–ª—å', '–ü–∏—Å—å–º–æ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –±–æ–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤');
```

2. **–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω –≤ email_templates:**
```sql
INSERT INTO email_templates (
    event_id, 
    content_type_id, 
    name,
    html_template,  -- HTML —Å {pain_points} –∏ {program_topics}
    subject_template,
    instructions    -- ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û! –ü–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI
)
VALUES (
    1,
    5,
    '–ü—Ä–æ–¥–∞–∂–∞ —á–µ—Ä–µ–∑ –±–æ–ª—å',
    '<html>...</html>',
    '{pain_points} - –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è Human',
    '–ü—Ä–æ–º—Ç –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞: ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π email-–ø–∏—Å—å–º–æ...¬ª
    
    –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
    –¢—ã ‚Äî email-–º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –≤ –∫–æ–º–∞–Ω–¥–µ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ Human.
    
    1. –¶–µ–ª—å –ø–∏—Å—å–º–∞: –ü—Ä–∏–≤–ª–µ—á—å –ø–µ—Ä–µ—Ö–æ–¥—ã –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥
    2. –§–æ—Ä–º–∞—Ç: –¶–µ–ø–ª—è—é—â–∏–π –∏–Ω—Å–∞–π—Ç (–æ–¥–Ω–∞ –±–æ–ª—å + 1-2 —Ä–µ—à–µ–Ω–∏—è)
    3. –¢–µ–º–∞ –ø–∏—Å—å–º–∞: –ñ–∏–≤–æ, –±–µ–∑ –∫–ª–∏—à–µ
       ‚úÖ "–ö–∞–∫ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ –¥–µ–Ω–µ–≥"
       ‚ùå "–ù–æ–≤–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è –ø–æ HR"
    4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
       - –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ: –ì–æ–≤–æ—Ä–∏–º –Ω–∞ —è–∑—ã–∫–µ –±–æ–ª–∏
       - –†–µ—à–µ–Ω–∏–µ: –ü–æ–∫–∞–∂–∏ —Å–ø–∏–∫–µ—Ä–∞/—Ç—Ä–µ–∫
       - 1-3 —Å–ø–∏–∫–µ—Ä–∞ —Å –∫–µ–π—Å–∞–º–∏
       - CTA: "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É"
    5. –¢–æ–Ω: –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –∫–∞–∫ –æ—Ç HR –¥–ª—è HR'
);
```

3. **–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Å—ã–ª–∫–∏:**
```sql
UPDATE event_mailing_lists
SET content_type_ids = array_append(content_type_ids, 5)
WHERE id = 3;
```

### ‚ùì –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏?

**–§–∞–π–ª:** `backend/events-manager/index.py`

**–ß–µ—Ä–Ω–æ–≤–∏–∫–∏ (–ë–ï–ó –¥—É–±–ª–µ–π):**
- –§—É–Ω–∫—Ü–∏—è: `generate_drafts` (—Å—Ç—Ä–æ–∫–∞ ~567)
- –ß—Ç–æ –º–µ–Ω—è—Ç—å: –ø—Ä–æ–º–ø—Ç –¥–ª—è AI, –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω (–° –¥—É–±–ª—è–º–∏):**
- –§—É–Ω–∫—Ü–∏—è: `generate_from_content_plan` (—Å—Ç—Ä–æ–∫–∞ ~750)
- –ß—Ç–æ –º–µ–Ω—è—Ç—å: –ø—Ä–æ–≤–µ—Ä–∫—É –¥—É–±–ª–µ–π, –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–∞

### ‚ùì –ü–æ—á–µ–º—É AI –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å–µ –±–æ–ª–∏ —Ü–µ–ª–∏–∫–æ–º?

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–æ
```python
html = html_template.replace('{pain_points}', pain_points_text)
```

**–†–µ—à–µ–Ω–∏–µ:** AI –¥–æ–ª–∂–µ–Ω **–≤—ã–±–∏—Ä–∞—Ç—å** –∫–æ–Ω—Ç–µ–Ω—Ç:
```python
ai_result = call_openai(instructions, program_text, pain_points_text)
html = html_template.replace('{pain_points}', ai_result['pain_points'])
```

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (—Å—Ç—Ä–æ–∫–∞ ~674 –≤ events-manager/index.py)

### ‚ùì –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –¥—É–±–ª–∏?

**generate_drafts:**
- ‚ùå –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏
- –ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ä–∞–∑
- –ö–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

**generate_from_content_plan:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ –ø–æ–ª—é `title`
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
- `skipped_count` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–µ–π

---

## üêõ Debugging

### –õ–æ–≥–∏ Backend

```bash
# –ß–µ—Ä–µ–∑ get_logs tool –≤ poehali.dev
source: "backend/events-manager"
limit: 100
```

**–ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
[AI_DRAFT] Generating draft using AI for content_type=1
  ‚Üí –ù–∞—á–∞–ª–æ AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

[SKIP] Draft already exists for list_id=3, content_type=1
  ‚Üí –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª—è (–¢–û–õ–¨–ö–û –≤ generate_from_content_plan!)

[ERROR] AI generation failed: JSONDecodeError - ...
  ‚Üí –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ AI

[CONTENT_PLAN] Generated 5 emails, skipped 3 duplicates
  ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç generate_from_content_plan
```

### Frontend –ª–æ–≥–∏

```bash
source: "frontend"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î

```sql
-- –°–∫–æ–ª—å–∫–æ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ —Å–æ–∑–¥–∞–Ω–æ?
SELECT COUNT(*) FROM generated_emails 
WHERE event_list_id = 3 AND status = 'draft';

-- –ï—Å—Ç—å –ª–∏ –¥—É–±–ª–∏ –ø–æ title?
SELECT title, COUNT(*) 
FROM generated_emails 
WHERE event_list_id = 3 
GROUP BY title 
HAVING COUNT(*) > 1;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ø–∏—Å–µ–º
SELECT id, subject, status, created_at 
FROM generated_emails 
ORDER BY created_at DESC 
LIMIT 5;
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã (–ö–†–ò–¢–ò–ß–ù–û!)

1. **AI - —ç—Ç–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞**, –∞ –Ω–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä HTML
   - AI –≤—ã–±–∏—Ä–∞–µ—Ç 2-4 —Å–ø–∏–∫–µ—Ä–∞ –∏–∑ 200
   - AI –≤—ã–±–∏—Ä–∞–µ—Ç 1-3 –±–æ–ª–∏ –∏–∑ 500
   - AI –Ω–µ –ø–∏—à–µ—Ç HTML —Å –Ω—É–ª—è

2. **HTML-—à–∞–±–ª–æ–Ω—ã** –∂–∏–≤—É—Ç –≤ –ë–î (`email_templates.html_template`)
   - –ì–æ—Ç–æ–≤–∞—è –≤—ë—Ä—Å—Ç–∫–∞ —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏
   - AI —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω—è–µ—Ç `{pain_points}` –∏ `{program_topics}`

3. **Instructions** - —ç—Ç–æ –ø—Ä–æ–º–ø—Ç –¥–ª—è AI
   - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –≤ `email_templates`
   - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ: —Ü–µ–ª—å, —Ñ–æ—Ä–º–∞—Ç, —Ç–æ–Ω, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
   - –ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö/–ø–ª–æ—Ö–∏—Ö —Ç–µ–º

4. **–î—É–±–ª–∏:**
   - `generate_drafts` - –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç
   - `generate_from_content_plan` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ `title`

5. **Simple Query Protocol:**
   - PostgreSQL –≤ –ø—Ä–æ–µ–∫—Ç–µ —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π
   - –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã
   - ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π `$1`, `$2`, `%s` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä—è–º—É—é –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É (—Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º)

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `backend/events-manager/index.py` - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `backend/google-docs-reader/index.py` - –ß—Ç–µ–Ω–∏–µ Google Docs
- `src/pages/CampaignManager.tsx` - UI —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏
- `db_migrations/V*.sql` - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-29  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
